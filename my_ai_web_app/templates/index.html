<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Prediction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Upload an Image for AI Prediction</h1>
    <form id="predictForm" enctype="multipart/form-data">
        <input type="file" id="inputImage" name="file" accept="image/*">
        <label for="confidenceThreshold">Confidence Threshold: <span id="confidenceValue">0.6</span></label>
        <input type="range" id="confidenceThreshold" name="confidenceThreshold" min="0" max="1" step="0.01" value="0.6">
        <button type="submit">Predict</button>
    </form>
    <div id="output"></div>
    <img id="predictedImage" style="display:none;" alt="Predicted Image">
    <script>
        const confidenceThreshold = document.getElementById('confidenceThreshold');
        const confidenceValue = document.getElementById('confidenceValue');

        confidenceThreshold.oninput = function() {
            confidenceValue.textContent = this.value;
        }

        document.getElementById('predictForm').onsubmit = async function(event) {
            event.preventDefault();
            const formData = new FormData();
            const fileField = document.querySelector('input[type="file"]');
            formData.append('file', fileField.files[0]);
            formData.append('confidenceThreshold', confidenceThreshold.value);

            const response = await fetch('/predict', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();

            let outputHtml = `<h2>Filename: ${result.filename}</h2>`;
            outputHtml += '<h3>Predictions:</h3><ul>';
            result.labels.forEach((label, index) => {
                outputHtml += `<li>Box: ${result.boxes[index]}, Label: ${label}, Score: ${result.scores[index].toFixed(2)}</li>`;
            });
            outputHtml += '</ul>';

            document.getElementById('output').innerHTML = outputHtml;
            document.getElementById('predictedImage').src = result.image_url;
            document.getElementById('predictedImage').style.display = 'block';
        }
    </script>
</body>
</html>
